<!DOCTYPE html>
<html lang="es">
<head>
  <!-- GA -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D5YSD14H3P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-D5YSD14H3P');

    const tracker = {
      sendClick: (item, pos) => {
        gtag('event', 'select_item', {
          items: [{ item_name: item.text_content, item_variant: pos, location_id: item.marketplace }]
        });
      },
      sendImpression: (item) => {
        gtag('event', 'view_item', {
          items: [{ item_name: item.text_content, location_id: item.marketplace }]
        });
      }
    };
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ES Finds - Tu Guía de Compras en España</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

  <style>
    :root { --main-dark:#1a202c; --accent-orange:#f6ad55; }
    .glass-nav{background:rgba(255,255,255,.98);backdrop-filter:blur(12px);border-bottom:2px solid var(--accent-orange)}
    .swiper{width:100%;height:350px;border-radius:20px;margin-bottom:30px}
    .swiper-slide{position:relative;background:var(--main-dark)}
    .brand-gradient{background:linear-gradient(135deg,#f6ad55 0%,#ed8936 100%)}
    #product-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:768px){#product-grid{grid-template-columns:repeat(4,1fr);gap:20px}}
    @media(min-width:1280px){#product-grid{grid-template-columns:repeat(5,1fr)}}
    .product-card{border:1px solid #edf2f7;background:white;border-radius:12px;transition:.3s}
    .fade-in{animation:fadeIn .5s ease forwards}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    footer{background:var(--main-dark);color:#a0aec0;padding:60px 20px;font-size:13px}
  </style>
</head>

<body class="bg-slate-50 text-slate-900">

<div class="bg-slate-800 text-slate-300 text-[10px] py-1.5 text-center uppercase">
  Como afiliado, percibo ingresos por compras adscritas.
</div>

<nav class="glass-nav sticky top-0 z-50 px-4 py-3">
  <div class="max-w-7xl mx-auto flex items-center gap-2">
    <i class="fa-solid fa-bag-shopping text-orange-400 text-2xl"></i>
    <span class="text-xl font-extrabold">ES<span class="text-orange-500">FINDS</span></span>
  </div>
</nav>

<main class="max-w-7xl mx-auto px-4 py-8">

  <div id="carousel-container" class="hidden">
    <div class="swiper mySwiper shadow-xl">
      <div class="swiper-wrapper" id="carousel-wrapper"></div>
      <div class="swiper-pagination"></div>
    </div>
  </div>

  <div class="flex justify-between items-center mb-8">
    <h2 class="text-xl font-black flex items-center gap-2">
      <span class="w-1.5 h-8 bg-orange-500 rounded-full"></span>
      Selecciones del día
    </h2>
    <span id="stats" class="text-[10px] font-bold text-slate-400 bg-slate-200 px-2 py-1 rounded">
      CARGANDO…
    </span>
  </div>

  <div id="product-grid"></div>

  <div id="sentinel" class="py-16 flex justify-center">
    <div id="loader" class="animate-spin rounded-full h-10 w-10 border-b-2 border-orange-500"></div>
  </div>

</main>

<footer>
  <div class="max-w-7xl mx-auto grid md:grid-cols-2 gap-8">
    <div>
      <h4 class="text-white font-bold mb-2">Sobre ES Finds</h4>
      <p>Selección curada de ofertas actualizadas para usuarios en España.</p>
    </div>
    <div>
      <h4 class="text-white font-bold mb-2">Divulgación</h4>
      <p>Este sitio obtiene comisiones por compras adscritas.</p>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
/* ===== OneLink 配置 ===== */
const TRACK_ID = "site_esfinds-20";
function buildOneLink(asin){
  if(!asin) return "javascript:void(0)";
  return `https://www.amazon.com/dp/${encodeURIComponent(asin)}?tag=${TRACK_ID}`;
}

let allProducts = [];
let currentIndex = 0;
const itemsPerPage = 20;
let swiperInstance = null;

async function init(){
  const res = await fetch("products_data.json");
  const data = await res.json();

  allProducts = data.filter(p => p.marketplace?.toLowerCase() === "es");
  allProducts.sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));

  document.getElementById("stats").innerText = `${allProducts.length} PRODUCTOS`;

  renderCarousel(allProducts.slice(0,5));
  loadMore();
}

function renderCarousel(list){
  if(!list.length) return;
  document.getElementById("carousel-container").classList.remove("hidden");
  const wrap = document.getElementById("carousel-wrapper");

  wrap.innerHTML = list.map(item=>`
    <div class="swiper-slide">
      <div class="absolute inset-0 bg-black/70 z-10"></div>
      <img src="${item.item_main_pic}" class="absolute inset-0 w-full h-full object-cover opacity-40">
      <div class="relative z-20 flex items-center h-full p-8 gap-8 text-white">
        <img src="${item.item_main_pic}" class="h-40 w-40 bg-white p-4 rounded-xl">
        <div>
          <h3 class="text-2xl font-bold mb-4">${item.text_content}</h3>
          <a href="${buildOneLink(item.asin)}" target="_blank"
             class="px-8 py-4 brand-gradient rounded-xl font-bold">
             Ver producto
          </a>
        </div>
      </div>
    </div>
  `).join("");

  if(swiperInstance) swiperInstance.destroy();
  swiperInstance = new Swiper(".mySwiper",{loop:true,autoplay:{delay:4000},pagination:{el:".swiper-pagination"}});
}

function loadMore(){
  const grid = document.getElementById("product-grid");
  const batch = allProducts.slice(currentIndex,currentIndex+itemsPerPage);
  if(!batch.length){
    document.getElementById("loader").style.display="none";
    return;
  }

  batch.forEach(item=>{
    const card = document.createElement("div");
    card.className="product-card fade-in";
    card.innerHTML=`
      <a href="${buildOneLink(item.asin)}" target="_blank" class="block aspect-square p-4">
        <img src="${item.item_main_pic}" class="w-full h-full object-contain">
      </a>
      <div class="p-4">
        <h3 class="text-sm font-bold mb-3 line-clamp-3">${item.text_content}</h3>
        <a href="${buildOneLink(item.asin)}" target="_blank"
           class="block text-center py-2 bg-slate-800 text-orange-400 rounded-xl font-bold">
           Consultar
        </a>
      </div>
    `;
    grid.appendChild(card);
  });

  currentIndex += itemsPerPage;
}

init();
</script>

</body>
</html>
