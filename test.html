<!DOCTYPE html>
<html lang="en">
<head>
  <!-- GA -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D5YSD14H3P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-D5YSD14H3P');
  </script>

  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Global Finds ‚Äì Best Amazon Deals</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

<style>
:root{--dark:#111827;--accent:#f97316;--soft:#ffedd5}
.product-card{border:1px solid #e5e7eb;border-radius:16px;background:#fff;overflow:hidden;transition:.25s}
.product-card:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(0,0,0,.08)}
.badge{position:absolute;top:10px;left:10px;background:var(--accent);color:#fff;font-size:11px;font-weight:800;padding:4px 8px;border-radius:999px}
.badge-right{right:10px;left:auto;background:#000;font-size:10px}
.price{background:var(--soft);color:#9a3412;font-size:12px;font-weight:700;padding:4px 8px;border-radius:8px}
.cta{background:var(--dark);color:var(--accent);font-weight:800;padding:10px;border-radius:10px;text-align:center}
.tab-btn{padding:10px 18px;border-radius:999px;font-weight:800;font-size:14px}
.tab-active{background:var(--dark);color:var(--accent)}
</style>
</head>

<body class="bg-slate-50 text-slate-900">

<div class="bg-slate-800 text-slate-300 text-[10px] py-1 text-center">
  As an Amazon Associate, we earn from qualifying purchases.
</div>

<nav class="bg-white border-b px-4 py-3 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto flex items-center gap-2">
    <i class="fa-solid fa-bag-shopping text-orange-500 text-2xl"></i>
    <span class="text-xl font-extrabold">
      GLOBAL<span class="text-orange-500">FINDS</span>
    </span>
  </div>
</nav>

<main class="max-w-7xl mx-auto px-4 py-8">

  <!-- TABS -->
  <div class="flex gap-3 mb-6">
    <button id="tabDeals" class="tab-btn tab-active">üî• Featured Deals</button>
    <button id="tabPromos" class="tab-btn bg-white border">üéüÔ∏è Promo Codes</button>
  </div>

  <!-- ================= DEALS TAB ================= -->
  <section id="dealsTab">

    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-black">Top Rated & Low Price</h2>

      <select id="categorySelect"
        class="border border-slate-300 rounded-xl px-4 py-2 text-sm font-semibold">
      </select>
    </div>

    <div id="product-grid"
      class="grid grid-cols-2 md:grid-cols-4 xl:grid-cols-5 gap-4">
    </div>
  </section>

  <!-- ================= PROMO TAB ================= -->
  <section id="promoTab" class="hidden">

    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-black">üéüÔ∏è Active Promo Codes</h2>

      <select id="promoCategorySelect"
        class="border border-slate-300 rounded-xl px-4 py-2 text-sm font-semibold">
      </select>
    </div>

    <div id="promo-list"
      class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
    </div>
  </section>

</main>

<script>
/* ================= CONFIG ================= */
const TRACK_ID = "site_esfinds-20";
const PRODUCT_URL = "products_data_v.json";
const PROMO_URL = "promo_codes.json";

/* ================= UTILS ================= */
const now = () => new Date();
const buildLink = asin => `https://www.amazon.com/dp/${asin}?tag=${TRACK_ID}`;
const fPrice = v => Number(v||0).toFixed(2);
const fRating = v => v ? Number(v).toFixed(1) : "N/A";

/* ================= STATE ================= */
let allProducts = [];
let allPromos = [];
let currentCategory = "All";

/* ================= SCORE ================= */
function scoreProduct(p){
  const r = Number(p.review_rating||0);
  const c = Math.log10((p.review_count||0)+1);
  const pr = Number(p.price_discount||999);
  return r*c*(1/Math.sqrt(pr)) + Math.random()*0.15;
}

/* ================= TABS ================= */
function showTab(tab){
  dealsTab.classList.toggle("hidden", tab!=="deals");
  promoTab.classList.toggle("hidden", tab!=="promo");
  tabDeals.classList.toggle("tab-active", tab==="deals");
  tabPromos.classList.toggle("tab-active", tab==="promo");
}
tabDeals.onclick=()=>showTab("deals");
tabPromos.onclick=()=>showTab("promo");

/* ================= PRODUCTS ================= */
function renderProducts(){
  product-grid.innerHTML="";
  let list=currentCategory==="All"?allProducts:
    allProducts.filter(p=>p.category_name===currentCategory);

  list.map(p=>({...p,_s:scoreProduct(p)}))
    .sort((a,b)=>b._s-a._s)
    .slice(0,60)
    .forEach(p=>{
      product-grid.innerHTML+=`
      <div class="product-card">
        <div class="relative bg-slate-100 aspect-square">
          ${p.discount_percent?`<span class="badge">-${p.discount_percent}%</span>`:""}
          <span class="badge badge-right">Amazon</span>
          <a href="${buildLink(p.asin)}" target="_blank">
            <img src="${p.main_image}" class="w-full h-full object-contain p-6">
          </a>
        </div>
        <div class="p-4 flex flex-col gap-2">
          <h3 class="text-sm font-bold line-clamp-3">${p.title}</h3>
          <div class="flex justify-between text-xs">
            <span class="price">${p.currency}${fPrice(p.price_discount)}</span>
            ${p.price_original?`<span class="line-through text-slate-400">${p.currency}${fPrice(p.price_original)}</span>`:""}
          </div>
          <div class="text-[11px] text-slate-500">
            ‚≠ê ${fRating(p.review_rating)} (${p.review_count||0})
          </div>
          <a href="${buildLink(p.asin)}" target="_blank" class="cta">View Deal</a>
        </div>
      </div>`;
    });
}

function renderCategorySelect(cats){
  categorySelect.innerHTML="<option>All</option>";
  cats.forEach(c=>categorySelect.innerHTML+=`<option>${c}</option>`);
  categorySelect.onchange=()=>{currentCategory=categorySelect.value;renderProducts();}
}

/* ================= PROMOS ================= */
const promoActive=p=>new Date(p.start_at)<=now()&&now()<=new Date(p.end_at);

function renderPromoCategories(){
  promoCategorySelect.innerHTML="<option>All</option>";
  [...new Set(allPromos.map(p=>p.category))].sort()
    .forEach(c=>promoCategorySelect.innerHTML+=`<option>${c}</option>`);
  promoCategorySelect.onchange=()=>renderPromos(promoCategorySelect.value);
}

function renderPromos(cat="All"){
  promo-list.innerHTML="";
  allPromos.filter(p=>promoActive(p)&&(cat==="All"||p.category===cat))
    .forEach(p=>{
      promo-list.innerHTML+=`
      <div class="border rounded-xl bg-white p-4">
        <div class="text-xs font-bold text-orange-500">${p.category}</div>
        <div class="font-semibold text-sm">
          Save ${p.discount_percent}% on ${p.brand}
        </div>
        <div class="flex justify-between items-center mt-2">
          <code class="bg-slate-100 px-3 py-1 rounded">${p.promo_code}</code>
          <button class="text-orange-500 font-bold text-xs"
            onclick="navigator.clipboard.writeText('${p.promo_code}');
              window.open('https://www.amazon.com/?tag=${TRACK_ID}')">
            Copy & Shop ‚Üí
          </button>
        </div>
      </div>`;
    });
}

/* ================= INIT ================= */
async function init(){
  allProducts = await (await fetch(PRODUCT_URL)).json();
  allPromos = await (await fetch(PROMO_URL)).json();

  renderPromoCategories();
  renderPromos();

  renderCategorySelect(
    [...new Set(allProducts.map(p=>p.category_name).filter(Boolean))].sort()
  );
  renderProducts();
}
init();
</script>

</body>
</html>
