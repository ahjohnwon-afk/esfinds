<!DOCTYPE html>
<html lang="en">
<head>
  <!-- GA -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D5YSD14H3P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-D5YSD14H3P');
  </script>

  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Global Finds ‚Äì Best Amazon Deals</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

<style>
:root{--dark:#111827;--accent:#f97316;--soft:#ffedd5}
.product-card{border:1px solid #e5e7eb;border-radius:16px;background:#fff;overflow:hidden;transition:.25s}
.product-card:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(0,0,0,.08)}
.badge{position:absolute;top:10px;left:10px;background:var(--accent);color:#fff;font-size:11px;font-weight:800;padding:4px 8px;border-radius:999px}
.badge-right{right:10px;left:auto;background:#000;font-size:10px}
.price{background:var(--soft);color:#9a3412;font-size:12px;font-weight:700;padding:4px 8px;border-radius:8px}
.cta{background:var(--dark);color:var(--accent);font-weight:800;padding:10px;border-radius:10px;text-align:center}
select{appearance:none;background:white}
</style>
</head>

<body class="bg-slate-50 text-slate-900">

<div class="bg-slate-800 text-slate-300 text-[10px] py-1 text-center">
  As an Amazon Associate, we earn from qualifying purchases.
</div>

<nav class="bg-white border-b px-4 py-3 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto flex items-center gap-2">
    <i class="fa-solid fa-bag-shopping text-orange-500 text-2xl"></i>
    <span class="text-xl font-extrabold">
      GLOBAL<span class="text-orange-500">FINDS</span>
    </span>
  </div>
</nav>

<main class="max-w-7xl mx-auto px-4 py-8">

  <!-- Header Row -->
  <div class="flex items-center justify-between mb-6 gap-4">
    <h2 class="text-xl font-black flex items-center gap-2">
      üî• Featured Deals
    </h2>

    <!-- Category Dropdown -->
    <div class="relative">
      <select id="categorySelect"
        class="border border-slate-300 rounded-xl px-4 py-2 pr-10 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-orange-400">
      </select>
      <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"></i>
    </div>
  </div>

  <!-- Products -->
  <div id="product-grid"
       class="grid grid-cols-2 md:grid-cols-4 xl:grid-cols-5 gap-4">
  </div>

</main>

<script>
/* =============================
   Config
============================= */
const TRACK_ID = "site_esfinds-20";
const DATA_URL = "products_data_v.json";

/* =============================
   Utils
============================= */
function buildLink(asin){
  return `https://www.amazon.com/dp/${asin}?tag=${TRACK_ID}`;
}
function formatPrice(v){
  return v === null || v === undefined ? "" : Number(v).toFixed(2);
}
function formatRating(v){
  return v === null || v === undefined ? "N/A" : Number(v).toFixed(1);
}

/* =============================
   Ranking Logic
============================= */
function scoreProduct(p){
  const rating = Number(p.review_rating || 0);
  const reviews = Math.log10((p.review_count || 0) + 1);
  const price = Number(p.price_discount || 999);
  const priceFactor = price > 0 ? 1 / Math.sqrt(price) : 0;
  const randomBoost = Math.random() * 0.15;
  return (rating * reviews * priceFactor) + randomBoost;
}

/* =============================
   State
============================= */
let allProducts = [];
let currentCategory = "All";

/* =============================
   Render
============================= */
function renderProducts(){
  const grid = document.getElementById("product-grid");
  grid.innerHTML = "";

  let list = currentCategory === "All"
    ? allProducts
    : allProducts.filter(p => p.category_name === currentCategory);

  list
    .map(p => ({...p, _score: scoreProduct(p)}))
    .sort((a,b)=>b._score - a._score)
    .slice(0, 60)
    .forEach(p=>{
      const div = document.createElement("div");
      div.className = "product-card";

      div.innerHTML = `
        <div class="relative bg-slate-100 aspect-square">
          ${p.discount_percent ? `<span class="badge">-${p.discount_percent}%</span>` : ""}
          <span class="badge badge-right">Amazon</span>
          <a href="${buildLink(p.asin)}" target="_blank">
            <img src="${p.main_image}" class="w-full h-full object-contain p-6">
          </a>
        </div>

        <div class="p-4 flex flex-col gap-2">
          <h3 class="text-sm font-bold line-clamp-3">${p.title}</h3>

          <div class="flex items-center justify-between text-xs">
            <span class="price">${p.currency}${formatPrice(p.price_discount)}</span>
            ${p.price_original ? `<span class="line-through text-slate-400">${p.currency}${formatPrice(p.price_original)}</span>` : ""}
          </div>

          <div class="text-[11px] text-slate-500">
            ‚≠ê ${formatRating(p.review_rating)} (${p.review_count || 0})
            ${p.coupon_type ? " ¬∑ " + p.coupon_type : ""}
          </div>

          <a href="${buildLink(p.asin)}" target="_blank" class="cta">
            View Deal
          </a>
        </div>
      `;
      grid.appendChild(div);
    });
}

function renderCategorySelect(categories){
  const select = document.getElementById("categorySelect");
  select.innerHTML = "";

  ["All", ...categories].forEach(cat=>{
    const opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    select.appendChild(opt);
  });

  select.onchange = () => {
    currentCategory = select.value;
    renderProducts();
  };
}

/* =============================
   Init
============================= */
async function init(){
  const res = await fetch(DATA_URL);
  allProducts = await res.json();

  const categories = [...new Set(
    allProducts.map(p => p.category_name).filter(Boolean)
  )].sort();

  renderCategorySelect(categories);
  renderProducts();
}

init();
</script>

</body>
</html>
